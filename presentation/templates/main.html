<div id="st-diff" class="extension_block">
  <div class="inline-drawer" id="stdiff-drawer">
    <div class="inline-drawer-toggle inline-drawer-header">
      <b>酒馆构筑对比工具</b>

      <div class="stdiff-drawer-actions">
        <button
          type="button"
          class="menu_button menu_button_icon stdiff-update-check"
          data-stdiff-action="check-update"
          title="检查云端更新"
          aria-label="检查云端更新"
        >
          <i class="fa-solid fa-cloud-arrow-down"></i>
        </button>
      </div>

      <!-- 图标仅作为视觉标识，点击行为由酒馆全局接管，不重复绑定 -->
      <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>
    </div>
    <div class="inline-drawer-content">
      <div class="stdiff-global-toggle">
        <label class="checkbox_label"><input type="checkbox" id="stdiff-enabled"> 启用世界书对比</label>
      </div>

      <div id="stdiff-noass" class="stdiff-section" data-stdiff-section="root">
        <div class="stdiff-section-header">
          <div class="stdiff-noass-header-main">
            <label class="checkbox_label">
              <input type="checkbox" id="stdiff-noass-enabled">
              启用 noass（对话合并与 clewd 正则）
            </label>
          </div>
          <button type="button" class="menu_button stdiff-noass-collapse" data-stdiff-collapse="root" aria-expanded="true" title="折叠/展开">
            <i class="fa-solid fa-chevron-up"></i>
          </button>
        </div>
        <div id="stdiff-noass-body" class="stdiff-section-body">
          <div class="stdiff-noass-block" data-stdiff-section="template">
            <div class="stdiff-noass-block-header">
              <div class="stdiff-noass-header-main">
                <span class="stdiff-noass-block-title">配置模板</span>
              </div>
              <button type="button" class="menu_button stdiff-noass-collapse" data-stdiff-collapse="template" aria-expanded="true" title="折叠/展开">
                <i class="fa-solid fa-chevron-up"></i>
              </button>
            </div>
            <div class="stdiff-noass-block-body">
              <div class="stdiff-noass-line">
                <span class="stdiff-noass-label">配置模板</span>
                <select id="stdiff-noass-tpl-select" class="text_pole"></select>
                <div class="stdiff-noass-btns">
                  <button class="menu_button" id="stdiff-noass-tpl-new">新建</button>
                  <button class="menu_button" id="stdiff-noass-tpl-dup">复制</button>
                  <button class="menu_button" id="stdiff-noass-tpl-rename">重命名</button>
                  <button class="menu_button" id="stdiff-noass-tpl-del">删除</button>
                  <button class="menu_button" id="stdiff-noass-tpl-save">保存当前</button>
                  <button class="menu_button" id="stdiff-noass-tpl-export">导出</button>
                  <button class="menu_button" id="stdiff-noass-tpl-import">导入</button>
                  <input type="file" id="stdiff-noass-tpl-import-file" accept=".json" style="display:none">
                </div>
              </div>

              <div class="stdiff-noass-grid">
                <label for="stdiff-noass-user">user</label>
                <input class="text_pole" id="stdiff-noass-user" spellcheck="false">
                <label for="stdiff-noass-assistant">assistant</label>
                <input class="text_pole" id="stdiff-noass-assistant" spellcheck="false">
                <label for="stdiff-noass-example-user">example_user</label>
                <input class="text_pole" id="stdiff-noass-example-user" spellcheck="false">
                <label for="stdiff-noass-example-assistant">example_assistant</label>
                <input class="text_pole" id="stdiff-noass-example-assistant" spellcheck="false">
                <label for="stdiff-noass-system">system</label>
                <input class="text_pole" id="stdiff-noass-system" spellcheck="false">
                <label for="stdiff-noass-separator">separator</label>
                <input class="text_pole" id="stdiff-noass-separator" spellcheck="false">
                <label for="stdiff-noass-sep-system">separator_system <small>例如：<SYS/></small></label>
                <input class="text_pole" id="stdiff-noass-sep-system" spellcheck="false">
                <label for="stdiff-noass-prefill">prefill_user</label>
                <input class="text_pole" id="stdiff-noass-prefill" spellcheck="false">
              </div>

              <div class="stdiff-noass-checks">
                <label><input type="checkbox" id="stdiff-noass-single-user"> 启用单 user</label>
                <label><input type="checkbox" id="stdiff-noass-clean-clewd"> 清理空 clewd 正则</label>
                <label><input type="checkbox" id="stdiff-noass-inject-prefill"> 注入 user 预填充消息</label>
                <label><input type="checkbox" id="stdiff-noass-cap-enabled"> 启用数据捕获</label>
              </div>
            </div>
          </div>

          <div class="stdiff-noass-block" data-stdiff-section="capture">
            <div class="stdiff-noass-block-header">
              <div class="stdiff-noass-header-main">
                <span class="stdiff-noass-block-title">数据捕获规则</span>
                <div class="stdiff-noass-btns">
                  <button class="menu_button" id="stdiff-noass-add-rule">添加规则</button>
                  <button class="menu_button" id="stdiff-noass-save-rules">保存规则</button>
                </div>
              </div>
              <button type="button" class="menu_button stdiff-noass-collapse" data-stdiff-collapse="capture" aria-expanded="true" title="折叠/展开">
                <i class="fa-solid fa-chevron-up"></i>
              </button>
            </div>
            <div class="stdiff-noass-block-body">
              <div id="stdiff-noass-rules" class="stdiff-noass-rules"></div>
            </div>
          </div>

          <div id="stdiff-noass-worldbook" class="stdiff-noass-block stdiff-worldbook-section" data-stdiff-section="worldbook">
            <div class="stdiff-noass-block-header">
              <div class="stdiff-noass-header-main">
                <div class="stdiff-worldbook-header">
                  <span class="stdiff-worldbook-title">世界书搬移策略</span>
                  <div class="stdiff-worldbook-header-controls">
                    <label class="checkbox_label stdiff-worldbook-debug">
                      <input type="checkbox" id="stdiff-noass-worldbook-debug">
                      输出调试日志
                    </label>
                    <div class="stdiff-noass-btns stdiff-worldbook-nav-buttons">
                      <button class="menu_button" id="stdiff-noass-worldbook-prev">上一组</button>
                      <span class="stdiff-worldbook-index" id="stdiff-noass-worldbook-index">0 / 0</span>
                      <button class="menu_button" id="stdiff-noass-worldbook-next">下一组</button>
                      <button class="menu_button" id="stdiff-noass-worldbook-add">新建</button>
                      <button class="menu_button" id="stdiff-noass-worldbook-dup">复制</button>
                      <button class="menu_button" id="stdiff-noass-worldbook-del">删除</button>
                    </div>
                  </div>
                </div>
              </div>
              <button type="button" class="menu_button stdiff-noass-collapse" data-stdiff-collapse="worldbook" aria-expanded="true" title="折叠/展开">
                <i class="fa-solid fa-chevron-up"></i>
              </button>
            </div>

            <div class="stdiff-noass-block-body">
              <div class="stdiff-worldbook-overview">
                <label class="checkbox_label">
                  <input type="checkbox" id="stdiff-noass-worldbook-enabled">
                  启用当前策略
                </label>
                <input class="text_pole" id="stdiff-noass-worldbook-label" spellcheck="false" placeholder="策略名称">
                <div class="stdiff-worldbook-meta">
                  <label for="stdiff-noass-worldbook-order">全局排序</label>
                  <input type="number" class="text_pole" id="stdiff-noass-worldbook-order" min="0" step="1">
                </div>
              </div>
              <div class="stdiff-worldbook-summary" id="stdiff-noass-worldbook-summary"></div>

              <div class="stdiff-worldbook-grid">
              <div class="stdiff-worldbook-column">
                <div class="stdiff-fieldset">
                  <div class="stdiff-fieldset-title">深度选择</div>
                  <div class="stdiff-worldbook-mode">
                    <label class="radio_label">
                      <input type="radio" name="stdiff-noass-worldbook-mode" id="stdiff-noass-worldbook-mode-range" value="depthRange">
                      指定范围 [min..max]
                    </label>
                    <label class="radio_label">
                      <input type="radio" name="stdiff-noass-worldbook-mode" id="stdiff-noass-worldbook-mode-gte" value="depthGE">
                      大于等于 ≥ min
                    </label>
                  </div>
                  <div class="stdiff-worldbook-depth-inputs">
                    <label for="stdiff-noass-worldbook-depth-min">最小深度</label>
                    <input type="number" class="text_pole" id="stdiff-noass-worldbook-depth-min" min="0" step="1">
                    <label for="stdiff-noass-worldbook-depth-max" class="stdiff-worldbook-depth-max-label">最大深度</label>
                    <input type="number" class="text_pole" id="stdiff-noass-worldbook-depth-max" min="0" step="1">
                  </div>
                  <div class="stdiff-worldbook-depth-chips" id="stdiff-noass-worldbook-depth-chips" aria-label="排除深度"></div>
                  <div class="stdiff-worldbook-depth-extra">
                    <input class="text_pole" id="stdiff-noass-worldbook-depth-custom" placeholder="额外排除深度，逗号分隔">
                    <button class="menu_button" id="stdiff-noass-worldbook-depth-add">添加排除深度</button>
                  </div>
                </div>

                <div class="stdiff-fieldset">
                  <div class="stdiff-fieldset-title">白名单（排除标题）</div>
                  <select id="stdiff-noass-worldbook-whitelist-select" class="text_pole">
                    <option value="">从启用世界书条目中选择</option>
                  </select>
                  <div class="stdiff-worldbook-whitelist-actions">
                    <input class="text_pole" id="stdiff-noass-worldbook-whitelist-input" placeholder="自定义标题">
                    <div class="stdiff-noass-btns">
                      <button class="menu_button" id="stdiff-noass-worldbook-whitelist-add">添加排除项</button>
                      <button class="menu_button" id="stdiff-noass-worldbook-whitelist-clear">清空排除</button>
                    </div>
                  </div>
                  <div id="stdiff-noass-worldbook-whitelist-tags" class="stdiff-taglist"></div>
                </div>
              </div>

                <div class="stdiff-worldbook-column">
                <div class="stdiff-fieldset">
                  <div class="stdiff-fieldset-title">目标位置</div>
                  <label for="stdiff-noass-worldbook-target-anchor">目标锚点</label>
                  <select id="stdiff-noass-worldbook-target-anchor" class="text_pole">
                    <option value="before">附加在合并消息前 (before)</option>
                    <option value="after">附加在合并消息后 (after)</option>
                    <option value="header">写入合并内容开头 (header)</option>
                    <option value="memory">写入合并内容末尾 (memory)</option>
                    <option value="custom">替换自定义标记 (custom)</option>
                  </select>
                  <label for="stdiff-noass-worldbook-target-custom">自定义标记</label>
                  <input class="text_pole" id="stdiff-noass-worldbook-target-custom" spellcheck="false" placeholder="仅 custom 时有效">
                  <label for="stdiff-noass-worldbook-target-role">注入角色</label>
                  <input class="text_pole" id="stdiff-noass-worldbook-target-role" spellcheck="false" placeholder="system / user / assistant">
                  <label for="stdiff-noass-worldbook-target-order">执行顺序</label>
                  <input type="number" class="text_pole" id="stdiff-noass-worldbook-target-order" step="1">
                  <label class="checkbox_label stdiff-worldbook-clean">
                    <input type="checkbox" id="stdiff-noass-worldbook-clean-orphan">
                    未命中时移除目标标记
                  </label>
                </div>

                <div class="stdiff-fieldset">
                  <div class="stdiff-fieldset-title">调试 / 快照</div>
                  <div id="stdiff-noass-worldbook-snapshot" class="stdiff-worldbook-snapshot">尚未收到世界书激活事件</div>
                  <div class="stdiff-worldbook-footer">
                    <button class="menu_button" id="stdiff-noass-worldbook-refresh">刷新快照</button>
                    <button class="menu_button" id="stdiff-noass-worldbook-dryrun">Dry Run</button>
                  </div>
                  <pre id="stdiff-noass-worldbook-log" class="stdiff-worldbook-log"></pre>
                </div>
                </div>
              </div>
            </div>
          </div>

          <div class="stdiff-noass-block" data-stdiff-section="storage">
            <div class="stdiff-noass-block-header">
              <div class="stdiff-noass-header-main">
                <span class="stdiff-noass-block-title">捕获数据存储</span>
                <div class="stdiff-noass-btns">
                  <button class="menu_button" id="stdiff-noass-storage-refresh">刷新查看</button>
                  <button class="menu_button" id="stdiff-noass-storage-clear">清空所有存储数据</button>
                </div>
              </div>
              <button type="button" class="menu_button stdiff-noass-collapse" data-stdiff-collapse="storage" aria-expanded="true" title="折叠/展开">
                <i class="fa-solid fa-chevron-up"></i>
              </button>
            </div>
            <div class="stdiff-noass-block-body">
              <div id="stdiff-noass-storage-list" class="stdiff-noass-storage"></div>
            </div>
          </div>
        </div><!-- end #stdiff-noass-body -->
      </div><!-- end #stdiff-noass -->
  
      <div id="stdiff-macros" class="stdiff-section" data-stdiff-section="macros">
      <div class="stdiff-section-header">
        <div class="stdiff-macros-header-main">
          <label class="checkbox_label">
            <input type="checkbox" id="stdiff-macros-enabled">
            启用宏模块
          </label>
          <span class="stdiff-macros-title">宏管理</span>
          <div class="stdiff-macros-actions" data-macros-actions></div>
        </div>
        <button type="button" class="menu_button stdiff-macros-collapse" data-stdiff-collapse="macros" aria-expanded="true" title="折叠/展开">
          <i class="fa-solid fa-chevron-up"></i>
        </button>
      </div>
      <div class="stdiff-section-body" id="stdiff-macros-body">
        <div class="stdiff-macros" data-macros-panel>
          <nav class="stdiff-macros-tabs" data-macros-tabs>
            <button type="button" class="menu_button is-active" data-tab="roulette">Roulette宏</button>
            <button type="button" class="menu_button" data-tab="cascade">Cascade宏</button>
            <button type="button" class="menu_button" data-tab="flow">Flow宏</button>
          </nav>
          <div class="stdiff-macros-content">
            <div class="stdiff-macros-pane is-active" data-pane="roulette"></div>
            <div class="stdiff-macros-pane" data-pane="cascade"></div>
            <div class="stdiff-macros-pane" data-pane="flow"></div>
          </div>
        </div>
      </div>
    </div>

    </div>

      <!-- 以下为占位，将在后续启用 -->
      <div class="st-diff-toolbar" style="display:none">
        <label>视图：
          <select data-stdiff-view-mode>
            <option value="side-by-side">并排</option>
            <option value="unified">合并</option>
          </select>
        </label>
        <label><input type="checkbox" data-stdiff-ignore-ws checked style="display:none"> 忽略空白</label>
        <label><input type="checkbox" data-stdiff-ignore-case style="display:none"> 忽略大小写</label>
        <button class="menu_button fa-solid fa-code-compare" data-stdiff-compare style="display:none">Compare</button>
      </div>

      <div class="st-diff-body" style="display:none">
        <div class="st-diff-left">
          <div class="st-diff-nav">Diff Navigator (占位)</div>
        </div>
        <div class="st-diff-center">
          <div class="st-diff-view">Diff View (占位)</div>
        </div>
        <div class="st-diff-right">
          <div class="st-diff-details">Field Details (占位)</div>
        </div>
      </div>
    </div>
  </div>
</div>
